<div class="container-page content-section-lg">
  <!-- Loading State -->
  @if (loading()) {
    <ui-skeleton-profile-page variant="user" [showAvatar]="!isOwner()" />
  }

  <!-- Error State -->
  @if (error() && !loading()) {
    <div class="text-center py-12">
      <p class="text-red-400">Utilisateur introuvable</p>
    </div>
  }

  <!-- Profile Content -->
  @if (profile() && !loading()) {
    <!-- Section 1: Header -->
    <div class="flex items-start gap-4">
      <!-- Avatar (only when viewing someone else's profile) -->
      @if (!isOwner()) {
        <ui-avatar [user]="avatarUser()" size="lg" />
      }

      <!-- Name + Username + Actions -->
      <div class="flex-1 min-w-0">
        <div class="flex items-start justify-between gap-4">
          <div>
            <h1 class="font-display text-2xl md:text-3xl text-gold-500 truncate">
              {{ displayName() }}
            </h1>
            <p class="text-smoke-400 text-sm">@{{ username() }}</p>
          </div>

          <!-- Stats -->
          <div class="flex items-center gap-4">
            <!-- Dégustations -->
            <div class="text-left">
              <p class="text-sm md:text-lg font-bold text-gold-500">{{ evaluationCount() }}</p>
              <p class="text-[10px] text-smoke-400 uppercase tracking-wide">Dégustations</p>
            </div>

            <!-- Marques (TODO: add to API) -->
            <div class="text-left">
              <p class="text-sm md:text-lg font-bold text-gold-500">{{ brandCount() }}</p>
              <p class="text-[10px] text-smoke-400 uppercase tracking-wide">Marques</p>
            </div>

            <!-- Share Button (desktop only, owner only) -->
            @if (isDesktop() && isOwner()) {
              <div [uiTooltip]="'Copier le lien'" tooltipPosition="bottom">
                <ui-button
                  size="icon"
                  variant="ghost"
                  icon="book-copy"
                  customClass="!rounded-lg"
                  (clicked)="copyProfileLink()"
                >
                  <span class="sr-only">Copier le lien du profil</span>
                </ui-button>
              </div>
            }
          </div>
        </div>

        <!-- Bio -->
        @if (bio()) {
          <p class="text-smoke-200 text-sm mt-3">{{ bio() }}</p>
        }

        <!-- Favorite Cigars (top 2 from 5 best rated tastings) -->
        <div class="mt-3 text-sm">
          <span class="text-smoke-400">Cigares les plus appréciés : </span>
          @if (hasTastings()) {
            <span class="text-smoke-200">{{ topCigars() }}</span>
          } @else {
            <span class="text-smoke-500 italic">Aucune dégustation pour le moment</span>
          }
        </div>
      </div>
    </div>

      <!-- Divider -->
      <div class="mt-6 h-px bg-smoke-600"></div>

    <!-- Club Avatars (horizontal scroll) -->
    @if (userClubs().length > 0) {
      <div class="mt-4 -mx-4 px-4 overflow-x-auto scrollbar-hide">
        <div class="flex items-center justify-start gap-3 py-2">
          @for (club of userClubs(); track club.id) {
            <a
              [routerLink]="['/club', club.slug]"
              [title]="club.name"
              class="flex-shrink-0 w-10 h-10 rounded-full overflow-hidden ring-2 ring-smoke-700 hover:ring-gold-500 hover:scale-110 transition-all"
            >
              @if (club.imageUrl) {
                <img
                  [src]="club.imageUrl"
                  [alt]="club.name"
                  class="w-full h-full object-cover"
                />
              } @else {
                <div class="w-full h-full bg-smoke-700 flex items-center justify-center">
                  <span class="text-xs font-bold text-smoke-400">
                    {{ club.name.charAt(0).toUpperCase() }}
                  </span>
                </div>
              }
            </a>
          }
        </div>
      </div>
    }

    <!-- Divider -->
    <div class="mt-6 h-px bg-smoke-600"></div>

    <!-- Section 3: Tastings Grid (3 mobile, 5 desktop) -->
    @if (tastingsLoading()) {
      <!-- Loading skeleton grid -->
      <div class="mt-6 grid grid-cols-3 md:grid-cols-5 gap-2">
        @for (slot of [1, 2, 3, 4, 5, 6, 7, 8, 9]; track slot) {
          <div class="aspect-4/5 rounded-sm bg-smoke-600 animate-pulse"></div>
        }
      </div>
    } @else if (tastings().length === 0) {
      <!-- Empty state -->
      <div class="mt-8 flex flex-col items-center justify-center py-12 gap-4">
        <div class="text-center">
          <p class="text-smoke-300 text-sm">Aucune dégustation pour le moment</p>
          <p class="text-smoke-400 text-xs mt-1">Commencez à déguster pour voir apparaître vos notes ici</p>
        </div>
        <ui-button
          variant="outline"
          icon="flame"
          [size]="'sm'"
          (clicked)="navigateToCreateTasting()"
        >
          Ajouter ma première note
        </ui-button>
      </div>
    } @else {
      <!-- Tastings grid -->
      <div class="mt-6 grid grid-cols-3 md:grid-cols-5 gap-2">
        @for (tasting of tastings(); track tasting.id) {
          <ui-tasting-card
            [tasting]="tasting"
            [showUsername]="false"
            (cardClick)="onTastingClick($event)"
          />
        }
      </div>

      <!-- Loading more indicator -->
      @if (loadingMore()) {
        <div class="mt-4 flex justify-center">
          <div class="w-6 h-6 border-2 border-gold-500 border-t-transparent rounded-full animate-spin"></div>
        </div>
      }

      <!-- Scroll sentinel for infinite scroll -->
      @if (hasMoreTastings()) {
        <div #scrollSentinel class="h-4"></div>
      }
    }
  }
</div>