<div class="container-page content-section-lg">
  <!-- Loading State -->
  @if (loading()) {
    <ui-skeleton-profile-page variant="user" [showAvatar]="!isOwner()" />
  }

  <!-- Error State -->
  @if (error() && !loading()) {
    <div class="text-center py-12">
      <p class="text-red-400">Utilisateur introuvable</p>
    </div>
  }

  <!-- Profile Content -->
  @if (profile() && !loading()) {
    <!-- Section 1: Header -->
    <!-- Layout A: Viewing someone else's profile (with avatar) - stacked layout -->
    @if (!isOwner()) {
      <!-- Row 1: Avatar + Name + Username -->
      <div class="flex items-center gap-4">
        <ui-avatar [user]="avatarUser()" size="lg" />
        <div class="min-w-0 flex-1">
          <h1 class="font-display text-2xl md:text-3xl text-gold-500 break-words">
            {{ displayName() }}
          </h1>
          <p class="text-smoke-400 text-sm">@{{ username() }}</p>
        </div>
      </div>

      <!-- Row 2: Stats -->
      <div class="mt-4 flex items-center gap-6">
        <div class="text-left">
          <p class="text-sm md:text-lg font-bold text-gold-500">{{ evaluationCount() }}</p>
          <p class="text-[10px] text-smoke-400 uppercase tracking-wide">Dégustations</p>
        </div>
        <div class="text-left">
          <p class="text-sm md:text-lg font-bold text-gold-500">{{ brandCount() }}</p>
          <p class="text-[10px] text-smoke-400 uppercase tracking-wide">Marques</p>
        </div>
      </div>

      <!-- Row 3: Bio + Favorite Cigars -->
      @if (bio()) {
        <p class="text-smoke-200 text-sm mt-4">{{ bio() }}</p>
      }
      <div class="mt-3 text-sm">
        <span class="text-smoke-400">Cigares les plus appréciés : </span>
        @if (hasTastings()) {
          <span class="text-smoke-200">{{ topCigars() }}</span>
        } @else {
          <span class="text-smoke-500 italic">Aucune dégustation pour le moment</span>
        }
      </div>
    }

    <!-- Layout B: Own profile (no avatar) - compact layout -->
    @if (isOwner()) {
      <div class="flex items-start gap-4">
        <div class="flex-1 min-w-0">
          <div class="flex items-start justify-between gap-4">
            <div class="min-w-0 flex-1">
              <h1 class="font-display text-2xl md:text-3xl text-gold-500 break-words">
                {{ displayName() }}
              </h1>
              <p class="text-smoke-400 text-sm">@{{ username() }}</p>
            </div>

            <!-- Stats -->
            <div class="flex items-center gap-4 flex-shrink-0">
              <div class="text-left">
                <p class="text-sm md:text-lg font-bold text-gold-500">{{ evaluationCount() }}</p>
                <p class="text-[10px] text-smoke-400 uppercase tracking-wide">Dégustations</p>
              </div>
              <div class="text-left">
                <p class="text-sm md:text-lg font-bold text-gold-500">{{ brandCount() }}</p>
                <p class="text-[10px] text-smoke-400 uppercase tracking-wide">Marques</p>
              </div>

              <!-- Share Button (desktop only) -->
              @if (isDesktop()) {
                <div [uiTooltip]="'Copier le lien'" tooltipPosition="bottom">
                  <ui-button
                    size="icon"
                    variant="ghost"
                    icon="book-copy"
                    customClass="!rounded-lg"
                    (clicked)="copyProfileLink()"
                  >
                    <span class="sr-only">Copier le lien du profil</span>
                  </ui-button>
                </div>
              }
            </div>
          </div>

          <!-- Bio -->
          @if (bio()) {
            <p class="text-smoke-200 text-sm mt-3">{{ bio() }}</p>
          }

          <!-- Favorite Cigars -->
          <div class="mt-3 text-sm">
            <span class="text-smoke-400">Cigares les plus appréciés : </span>
            @if (hasTastings()) {
              <span class="text-smoke-200">{{ topCigars() }}</span>
            } @else {
              <span class="text-smoke-500 italic">Aucune dégustation pour le moment</span>
            }
          </div>
        </div>
      </div>
    }

      <!-- Divider -->
      <div class="mt-6 h-px bg-smoke-600"></div>

    <!-- Club Avatars (horizontal scroll) -->
    @if (userClubs().length > 0) {
      <div class="mt-4 -mx-4 px-4 overflow-x-auto scrollbar-hide">
        <div class="flex items-center justify-start gap-3 py-2">
          @for (club of userClubs(); track club.id) {
            <a
              [routerLink]="['/club', club.slug]"
              [title]="club.name"
              class="flex-shrink-0 w-10 h-10 rounded-full overflow-hidden ring-2 ring-smoke-700 hover:ring-gold-500 hover:scale-110 transition-all"
            >
              @if (club.imageUrl) {
                <img
                  [src]="club.imageUrl"
                  [alt]="club.name"
                  class="w-full h-full object-cover"
                />
              } @else {
                <div class="w-full h-full bg-gradient-to-br from-gold-600 to-gold-800 flex items-center justify-center">
                  <span class="text-sm font-bold text-smoke-900">
                    {{ club.name.charAt(0).toUpperCase() }}
                  </span>
                </div>
              }
            </a>
          }
        </div>
      </div>
    }

    <!-- Divider -->
    <div class="mt-6 h-px bg-smoke-600"></div>

    <!-- Section 3: Tastings Grid -->
    <ui-tastings-grid
      [tastings]="tastings()"
      [loading]="tastingsLoading()"
      [loadingMore]="loadingMore()"
      [hasMore]="hasMoreTastings()"
      [showUsername]="false"
      [emptyMessage]="isOwner() ? 'Aucune dégustation pour le moment' : 'Cet utilisateur n\'a pas encore partagé de dégustations'"
      [emptySubMessage]="isOwner() ? 'Commencez à déguster pour voir apparaître vos notes ici' : null"
      [showAddButton]="isOwner()"
      addButtonLabel="Ajouter ma première note"
      (loadMore)="userTastingsQuery.loadMore()"
      (cardClick)="onTastingClick($event)"
      (addClick)="navigateToCreateTasting()"
    />
  }
</div>