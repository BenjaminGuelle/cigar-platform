<div class="min-h-screen">
  <!-- Mobile Header (< 768px) -->
  <ui-mobile-header
    [contextType]="context().type"
    [user]="currentUser()"
    [club]="context().club"
    [fabMenuOpen]="fabMenuOpen()"
    [fabMenuItems]="fabMenuItems()"
    (contextClick)="onContextClick()"
    (searchClick)="onSearchOpen()"
    (fabMenuToggle)="onFabMenuToggle()"
    (fabMenuClose)="onFabMenuClose()"
    (fabMenuItemClicked)="onFabMenuItemClick($event)"
  />

  <!-- Desktop Context Sidebar (≥ 768px) - Left avatar stack -->
  <ui-context-sidebar
    [user]="currentUser()"
    [clubs]="userClubs()"
    [activeContextType]="context().type"
    [activeClubId]="context().clubId"
    (contextSelected)="onContextSelected($event)"
    (createJoinClub)="onCreateJoinClub()"
  />

  <!-- Desktop Top Tabs (≥ 768px) - Horizontal navigation -->
  <ui-desktop-top-tabs (searchClick)="onSearchOpen()">
    <ui-desktop-top-tab-item
      label="Accueil"
      route="/dashboard"
      icon="home"
      [exact]="true"
    />
    <!-- Membres tab (only visible in club context) -->
    @if (context().type === 'club') {
      <ui-desktop-top-tab-item
        label="Membres"
        route="/membres"
        icon="users"
      />
    }
    <ui-desktop-top-tab-item
      label="Dégustations"
      route="/degustations"
      icon="flame"
    />
    <ui-desktop-top-tab-item
      label="Événements"
      route="/evenements"
      icon="calendar"
    />
    <ui-desktop-top-tab-item
      label="Notifications"
      route="/notifications"
      icon="bell"
      [badge]="3"
    />
    <!-- Settings tab (always visible in solo, only for admin/owner in club) -->
    @if (context().type === 'solo' || contextStore.canAccessSettings()) {
      <ui-desktop-top-tab-item
        label="Paramètres"
        route="/settings"
        icon="settings"
      />
    }
  </ui-desktop-top-tabs>

  <!-- Main Content Area -->
  <main class="min-h-screen overflow-auto px-4 pt-15 pb-24 md:pl-18 md:pr-8 md:pt-24 md:pb-8">
    <router-outlet />
  </main>

  <!-- Context Switcher (Mobile Bottom Sheet) -->
  <ui-context-switcher
    [isOpen]="contextSwitcherOpen()"
    [user]="currentUser()"
    [clubs]="userClubs()"
    [activeContext]="{ type: context().type, clubId: context().clubId }"
    (close)="onContextSwitcherClose()"
    (contextSelected)="onContextSelected($event)"
    (createJoinClub)="onCreateJoinClub()"
  />

  <ui-bottom-tab-bar>
    <ui-bottom-tab-item
      icon="home"
      label="Accueil"
      route="/dashboard"
      [exact]="true"
    />
    <!-- Membres tab (only in club context) -->
    @if (context().type === 'club') {
      <ui-bottom-tab-item
        icon="users"
        label="Membres"
        route="/membres"
      />
    }
    <ui-bottom-tab-item
      icon="flame"
      label="Dégustations"
      route="/degustations"
    />
    <ui-bottom-tab-item
      icon="bell"
      label="Notifs"
      route="/notifications"
      [badge]="3"
    />
    <!-- Settings tab (always visible in solo, only for admin/owner in club) -->
    @if (context().type === 'solo' || contextStore.canAccessSettings()) {
      <ui-bottom-tab-item
        icon="settings"
        label="Profil"
        route="/settings"
      />
    }
  </ui-bottom-tab-bar>

  <!-- Desktop FAB Menu - Quick Actions (≥ 768px) -->
  <ui-fab-menu
    class="hidden md:block"
    [isOpen]="fabMenuOpen()"
    [items]="fabMenuItems()"
    (toggle)="onFabMenuToggle()"
    (close)="onFabMenuClose()"
    (itemClicked)="onFabMenuItemClick($event)"
  />

  <!-- Create/Join Club Modal -->
  <app-create-join-club-modal
    [isOpen]="createJoinClubModalOpen()"
    (close)="onCreateJoinClubModalClose()"
    (clubCreated)="onClubCreated()"
    (clubJoined)="onClubJoined()"
  />

  <!-- Create Event Modal -->
  <app-create-content-modal
    [isOpen]="createContentModalOpen()"
    [contextClubName]="context().club?.name || null"
    (close)="onCreateContentModalClose()"
    (eventCreated)="onEventCreated()"
  />

  <!-- Global Search Modal -->
  <app-global-search
    [isOpen]="searchModalOpen()"
    (close)="onSearchClose()"
  />
</div>
