<div class="min-h-screen">
  <!-- Mobile Header (< 768px) -->
  <ui-mobile-header
    [contextType]="context().type"
    [user]="currentUser()"
    [club]="context().club"
    [fabMenuOpen]="fabMenuOpen()"
    [fabMenuItems]="fabMenuItems()"
    [notificationsBadge]="3"
    (contextClick)="onContextClick()"
    (notificationsClick)="onComingSoonOpen('Notifications')"
    (fabMenuToggle)="onFabMenuToggle()"
    (fabMenuClose)="onFabMenuClose()"
    (fabMenuItemClicked)="onFabMenuItemClick($event)"
  />

  <!-- Desktop Context Sidebar (≥ 768px) - Left avatar stack -->
  <ui-context-sidebar
    [user]="currentUser()"
    [clubs]="userClubs()"
    [activeContextType]="context().type"
    [activeClubId]="context().clubId"
    (contextSelected)="onContextSelected($event)"
    (createJoinClub)="onCreateJoinClub()"
  />

  <!-- Desktop Top Tabs (≥ 768px) - Horizontal navigation -->
  <ui-desktop-top-tabs
    [notificationsBadge]="3"
    (notificationsClick)="onComingSoonOpen('Notifications')"
  >
    <!-- 1. Dashboard (contextualisé : Solo = Dashboard perso, Club = Dashboard club) -->
    <ui-desktop-top-tab-item
      label="Accueil"
      route="/dashboard"
      icon="home"
      [exact]="true"
    />

    <!-- 2. Search (modal omnisearch) -->
    <ui-desktop-top-tab-item
      label="Recherche"
      [route]="null"
      icon="search"
      (clicked)="onSearchOpen()"
    />

    <!-- 3. Tasting (modal avec choix action) -->
    <ui-desktop-top-tab-item
      label="Dégustation"
      [route]="null"
      icon="flame"
      (clicked)="onFabMenuToggle()"
    />

    <!-- 4. Cave (prochainement) -->
    <ui-desktop-top-tab-item
      label="Cave"
      [route]="null"
      icon="book-copy"
      (clicked)="onComingSoonOpen('Cave')"
    />

    <!-- 5. Profil (contextuel) -->
    <ui-desktop-top-tab-item
      label="Profil"
      route="/profile"
      icon="user"
    />
  </ui-desktop-top-tabs>

  <!-- Main Content Area -->
  <main class="min-h-screen overflow-auto px-4 pt-15 pb-24 md:pl-18 md:pr-8 md:pt-24 md:pb-8">
    <router-outlet />
  </main>

  <!-- Context Switcher (Mobile Bottom Sheet) -->
  <ui-context-switcher
    [isOpen]="contextSwitcherOpen()"
    [user]="currentUser()"
    [clubs]="userClubs()"
    [activeContext]="{ type: context().type, clubId: context().clubId }"
    (close)="onContextSwitcherClose()"
    (contextSelected)="onContextSelected($event)"
    (createJoinClub)="onCreateJoinClub()"
  />

  <ui-bottom-tab-bar>
    <!-- 1. Dashboard (contextualisé : Solo = Dashboard perso, Club = Dashboard club) -->
    <ui-bottom-tab-item
      icon="home"
      label="Accueil"
      route="/dashboard"
      [exact]="true"
    />

    <!-- 2. Search (modal omnisearch) -->
    <ui-bottom-tab-item
      icon="search"
      label="Recherche"
      [route]="null"
      (clicked)="onSearchOpen()"
    />

    <!-- 3. Tasting (modal avec choix action) -->
    <ui-bottom-tab-item
      icon="flame"
      label="Créer"
      [route]="null"
      (clicked)="onFabMenuToggle()"
    />

    <!-- 4. Cave (prochainement) -->
    <ui-bottom-tab-item
      icon="book-copy"
      label="Cave"
      [route]="null"
      (clicked)="onComingSoonOpen('Cave')"
    />

    <!-- 5. Profil (contextuel) -->
    <ui-bottom-tab-item
      icon="user"
      label="Profil"
      route="/profile"
    />
  </ui-bottom-tab-bar>

  <!-- Desktop FAB Menu - Quick Actions (≥ 768px) -->
  <ui-fab-menu
    class="hidden md:block"
    [isOpen]="fabMenuOpen()"
    [items]="fabMenuItems()"
    (toggle)="onFabMenuToggle()"
    (close)="onFabMenuClose()"
    (itemClicked)="onFabMenuItemClick($event)"
  />

  <!-- Create/Join Club Modal -->
  <app-create-join-club-modal
    [isOpen]="createJoinClubModalOpen()"
    (close)="onCreateJoinClubModalClose()"
    (clubCreated)="onClubCreated()"
    (clubJoined)="onClubJoined()"
  />

  <!-- Create Event Modal -->
  <app-create-content-modal
    [isOpen]="createContentModalOpen()"
    [contextClubName]="context().club?.name || null"
    (close)="onCreateContentModalClose()"
    (eventCreated)="onEventCreated()"
  />

  <!-- Global Search Modal -->
  <app-global-search
    [isOpen]="searchModalOpen()"
    (close)="onSearchClose()"
  />

  <!-- Coming Soon Modal -->
  <ui-coming-soon-modal
    [isOpen]="comingSoonModalOpen()"
    [featureName]="comingSoonFeature()"
    (close)="onComingSoonClose()"
  />
</div>
