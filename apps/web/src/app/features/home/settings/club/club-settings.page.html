<div class="mx-auto max-w-4xl space-y-6 md:space-y-8 px-4 md:px-6 py-6 md:py-8">
  <!-- Guard: Must be club admin -->
  @if (!contextStore.canManageClub()) {
    <div class="flex flex-col items-center justify-center py-16 text-center">
      <div class="rounded-full bg-smoke-800/50 p-4 mb-4">
        <lucide-icon
          [img]="LockKeyhole"
          [size]="48"
          class="text-smoke-400"
        />
      </div>
      <h3 class="text-lg font-semibold text-smoke-100 mb-2">
        Accès restreint
      </h3>
      <p class="text-sm text-smoke-400 max-w-sm">
        Seuls les administrateurs peuvent accéder aux paramètres du club
      </p>
    </div>
  } @else if (loading()) {
    <!-- Loading State -->
    <div class="flex justify-center items-center py-16">
      <div class="animate-spin rounded-full h-12 w-12 border-2 border-gold-500 border-t-transparent"></div>
    </div>
  } @else {
    <!-- Settings Form -->
    <div class="space-y-8">
      <ui-page-header
        title="Paramètres du club"
        [description]="'Gérez les paramètres de ' + (club()?.name || 'votre club')"
      />

      <form [formGroup]="clubForm" (ngSubmit)="onUpdateClub()" class="space-y-8">
        <!-- Club Information Section -->
        <ui-page-section title="Informations du club">
          <div class="space-y-6 md:space-y-8">
            <ui-input
              inputId="club-name"
              type="text"
              label="Nom du club"
              placeholder="Ex: Les Aficionados du Cigare"
              [control]="clubForm.controls.name"
              [required]="true"
              autocomplete="off"
            />

            <div>
              <label class="block text-sm font-medium text-smoke-100 mb-2">
                Description
              </label>
              <textarea
                formControlName="description"
                rows="4"
                class="w-full px-4 py-3 rounded-lg border-2 border-smoke-700 bg-smoke-850 text-smoke-100 placeholder-smoke-500 focus:border-gold-500 focus:ring-2 focus:ring-gold-500/20 focus:outline-none transition-all duration-200 resize-none"
                placeholder="Décrivez votre club..."
              ></textarea>
              @if (clubForm.controls.description.invalid && clubForm.controls.description.touched) {
                <p class="mt-1.5 text-sm text-error-500">
                  Maximum 500 caractères
                </p>
              }
            </div>
          </div>
        </ui-page-section>

        <!-- Privacy & Access Section -->
        <ui-page-section title="Confidentialité & Accès">
          <div class="space-y-6 md:space-y-8">
            <!-- Visibility -->
            <ui-select
              selectId="visibility"
              label="Visibilité du club"
              hint="Les clubs publics sont visibles dans /explore. Les clubs privés ne sont accessibles que par invitation."
              [control]="clubForm.controls.visibility"
              [options]="visibilityOptions"
              [required]="true"
            />

            <!-- Public Directory (only for PUBLIC clubs) -->
            @if (clubForm.controls.visibility.value === 'PUBLIC') {
              <ui-checkbox
                checkboxId="public-directory"
                label="Répertoire public"
                description="Afficher ce club dans le répertoire public"
                [control]="clubForm.controls.isPublicDirectory"
              />

              <!-- Auto-approve members -->
              <ui-checkbox
                checkboxId="auto-approve"
                label="Approbation automatique"
                description="Accepter automatiquement les demandes d'adhésion"
                [control]="clubForm.controls.autoApproveMembers"
              />
            }

            <!-- Allow member invites -->
            <ui-checkbox
              checkboxId="member-invites"
              label="Invitations par les membres"
              description="Permettre aux membres d'inviter d'autres personnes"
              [control]="clubForm.controls.allowMemberInvites"
            />

            <!-- Max members -->
            <ui-input
              inputId="max-members"
              type="number"
              label="Nombre maximum de membres (optionnel)"
              placeholder="Illimité"
              hint="Laisser vide pour un nombre illimité de membres"
              [control]="clubForm.controls.maxMembers"
              [minlength]="1"
            />
          </div>
        </ui-page-section>

        <!-- Action Buttons -->
        <div class="flex justify-end gap-3 pt-4">
          @if (hasUnsavedChanges()) {
            <ui-button
              type="button"
              variant="ghost"
              size="md"
              [disabled]="updateClubMutation.loading()"
              (click)="onCancelChanges()"
            >
              Annuler
            </ui-button>
          }
          <ui-button
            type="submit"
            variant="outline"
            size="md"
            [loading]="updateClubMutation.loading()"
            [disabled]="!hasUnsavedChanges() || clubForm.invalid || updateClubMutation.loading()"
          >
            Enregistrer
          </ui-button>
        </div>
      </form>

      <!-- Danger Zone (Owner Only) -->
      @if (isOwner()) {
        <ui-page-section title="Zone de danger">
          <div class="rounded-lg border-2 border-error-500/30 bg-error-500/5 p-6">
            <div class="flex items-start justify-between gap-4">
              <div class="flex-1">
                <h3 class="text-base font-semibold text-smoke-100 mb-1">
                  Archiver le club
                </h3>
                <p class="text-sm text-smoke-400">
                  Le club ne sera plus accessible aux membres. Cette action est réversible.
                </p>
              </div>
              <button
                type="button"
                (click)="onArchiveClub()"
                class="shrink-0 px-4 py-2 bg-error-600 hover:bg-error-700 text-white font-medium rounded-lg transition-colors focus:ring-2 focus:ring-error-500/50 focus:outline-none"
              >
                Archiver
              </button>
            </div>
          </div>
        </ui-page-section>
      }
    </div>
  }
</div>
