<div class="mx-auto max-w-5xl space-y-6 px-4 py-8">
    <div>
      <h1 class="text-3xl font-bold text-smoke-50">Paramètres</h1>
      <p class="mt-2 text-sm text-smoke-200">Gérez votre profil et vos préférences</p>
    </div>

    <!-- Avatar messages -->
    @if (avatarMessage(); as message) {
      <div
        class="rounded-lg border p-4 text-sm"
        [class]="message.type === 'success'
          ? 'border-green-500/50 bg-green-500/10 text-green-400'
          : 'border-error-500/50 bg-error-500/10 text-error-400'"
      >
        {{ message.text }}
      </div>
    }

    <!-- Profile update messages -->
    @if (profileSuccess()) {
      <div class="rounded-lg border border-green-500/50 bg-green-500/10 p-4 text-sm text-green-400">
        {{ profileSuccess() }}
      </div>
    }
    @if (userStore.updateProfile.error(); as error) {
      <div class="rounded-lg border border-error-500/50 bg-error-500/10 p-4 text-sm text-error-400">
        {{ error.message }}
      </div>
    }

    <div class="rounded-xl border border-smoke-700 bg-smoke-800 p-6 shadow-xl shadow-smoke-950/50">
      <h2 class="mb-6 text-xl font-semibold text-smoke-50">Profil</h2>

      <div class="mb-10">
        <label class="mb-2 block text-sm font-medium text-smoke-300">Photo de profil</label>
        <div class="flex items-center gap-6">
          @if (selectedAvatarPreview()) {
            <img
              [src]="selectedAvatarPreview()!"
              alt="Preview"
              class="h-20 w-20 rounded-full object-cover shadow-lg"
            />
          } @else {
            <ui-avatar [user]="currentUser()" size="lg" />
          }

          <!-- Upload Button -->
          <div class="flex flex-col gap-2">
            <input
              type="file"
              id="avatar-upload"
              accept="image/jpeg,image/png,image/webp"
              (change)="onAvatarFileSelected($event)"
              class="hidden"
            />
            <label
              for="avatar-upload"
              class="cursor-pointer rounded-lg border-2 border-gold-500 bg-transparent px-4 py-2 text-sm font-semibold text-gold-500 transition-all hover:bg-gold-500/10 focus:outline-none focus:ring-2 focus:ring-gold-500/50"
            >
              @if (avatarUploadLoading()) {
                Chargement...
              } @else {
                Changer la photo
              }
            </label>
            <p class="text-xs text-smoke-200">JPEG, PNG ou WebP (max 5MB)</p>
          </div>
        </div>
      </div>

      <form [formGroup]="profileForm" (ngSubmit)="onUpdateProfile()" class="space-y-4">
        <ui-input
          inputId="displayName"
          type="text"
          label="Nom d'affichage"
          placeholder="Votre nom"
          [control]="profileForm.controls.displayName"
          [required]="true"
          autocomplete="name"
        />

        <div class="flex justify-end mt-4">
          <ui-button
            type="submit"
            variant="primary"
            [loading]="userStore.updateProfile.loading()"
            [disabled]="profileForm.invalid || userStore.updateProfile.loading()"
          >
            Enregistrer
          </ui-button>
        </div>
      </form>
    </div>

    <!-- Account Section -->
    <div class="rounded-xl border border-smoke-700 bg-smoke-800 p-6 shadow-xl shadow-smoke-950/50">
      <h2 class="mb-6 text-xl font-semibold text-smoke-50">Compte</h2>

      <!-- Email (Read-only) -->
      <div class="mb-6">
        <label class="mb-2 block text-sm font-medium text-smoke-300">Email</label>
        <div class="flex items-center gap-3">
          <div class="flex-1 rounded-lg border-2 border-smoke-700 bg-smoke-900 px-4 py-2.5 text-base text-smoke-400">
            {{ currentUser()?.email }}
          </div>
          <span
            class="rounded-full border px-3 py-1 text-xs font-medium"
            [class]="
              isOAuthUser()
                ? 'border-blue-500/50 bg-blue-500/10 text-blue-400'
                : 'border-smoke-600 bg-smoke-700 text-smoke-400'
            "
          >
            {{ providerLabel() }}
          </span>
        </div>
        @if (isOAuthUser()) {
          <p class="mt-2 text-xs text-smoke-200">
            Connecté via {{ providerLabel() }}. L'email ne peut pas être modifié.
          </p>
        }
      </div>

      <!-- Logout Button -->
      <div class="border-t border-smoke-700 pt-6">
        <ui-button
          type="button"
          variant="destructive"
          [loading]="logoutLoading()"
          [disabled]="logoutLoading()"
          (click)="onLogout()"
        >
          Se déconnecter
        </ui-button>
      </div>
    </div>

    <div class="rounded-xl border border-smoke-700 bg-smoke-800 p-6 shadow-xl shadow-smoke-950/50">
      <h2 class="mb-4 text-xl font-semibold text-smoke-50">À propos</h2>
      <div class="space-y-2 text-sm text-smoke-200">
        <p>Cigar & Club - Application de gestion de clubs de dégustation</p>
        <p class="text-xs text-smoke-200">Version 1.0.0</p>
      </div>
    </div>
  </div>