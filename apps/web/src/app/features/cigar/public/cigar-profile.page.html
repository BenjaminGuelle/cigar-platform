<div class="container-page content-section-lg">
  <!-- Loading State -->
  @if (loading()) {
    <div class="space-y-6">
      <!-- Header Skeleton -->
      <div class="space-y-3">
        <ui-skeleton size="heading-lg" />
        <div class="flex items-center gap-4">
          <ui-skeleton size="text-sm" />
          <ui-skeleton size="text-sm" />
        </div>
      </div>

      <!-- Specs Skeleton -->
      <div class="flex flex-wrap gap-x-6 gap-y-2">
        @for (i of [1, 2, 3, 4]; track i) {
          <ui-skeleton size="text-md" />
        }
      </div>

      <!-- Rating Skeleton -->
      <div class="flex flex-col items-center gap-4 py-6">
        <div class="flex gap-3">
          @for (i of [1, 2, 3, 4, 5]; track i) {
            <ui-skeleton size="avatar-sm" />
          }
        </div>
        <ui-skeleton size="text-sm" />
      </div>
    </div>
  }

  <!-- Error State -->
  @if (error() && !loading()) {
    <div class="text-center py-12">
      <h3 class="text-lg font-medium text-smoke-100">Cigare introuvable</h3>
      <p class="text-sm text-smoke-400 mt-2">Ce cigare n'existe pas ou a été supprimé</p>
    </div>
  }

  <!-- Loaded State -->
  @if (cigar() && !loading()) {
    <!-- Section 1: Header -->
    <div class="flex items-start justify-between gap-4">
      <div class="min-w-0 flex-1">
        <!-- Cigar Name -->
        <h1 class="font-display text-2xl md:text-3xl text-gold-500 break-words">
          {{ name() }}
        </h1>

        <!-- Brand & Origin -->
        <div class="flex items-center gap-4 mt-1 text-sm text-smoke-400">
          @if (brandName()) {
            <a [routerLink]="['/brand', brandSlug()]" class="hover:text-gold-500 transition-colors">
              {{ brandName() }}
            </a>
          }
          @if (brandCountry()) {
            <span class="flex items-center gap-1">
              <i icon name="globe" class="w-3.5 h-3.5"></i>
              {{ brandCountry() }}
            </span>
          }
        </div>
      </div>

      <!-- Action: Start Tasting -->
      <div [uiTooltip]="'Déguster ce cigare'" tooltipPosition="bottom">
        <ui-button
          size="icon"
          variant="ghost"
          icon="flame"
          customClass="!rounded-lg"
          (click)="startTasting()"
        >
          <span class="sr-only">Déguster ce cigare</span>
        </ui-button>
      </div>
    </div>

    <!-- Section 2: Specifications (inline text) -->
    <div class="mt-4 flex flex-wrap gap-x-6 gap-y-2 text-sm text-smoke-300">
      @if (vitola()) {
        <span class="flex items-center gap-1.5">
          <i icon name="box" class="w-4 h-4 text-gold-500"></i>
          {{ vitola() }}
        </span>
      }

      @if (dimensions()) {
        <span class="flex items-center gap-1.5">
          <i icon name="minus" class="w-4 h-4 text-gold-500"></i>
          {{ dimensions() }}
        </span>
      }

      @if (strength()) {
        <span class="flex items-center gap-1.5">
          <i icon name="flame" class="w-4 h-4 text-gold-500"></i>
          Force {{ strength() }}/5
        </span>
      }

      @if (wrapper()) {
        <span class="flex items-center gap-1.5">
          <i icon name="sparkles" class="w-4 h-4 text-gold-500"></i>
          {{ wrapper() }}
        </span>
      }

      @if (origin()) {
        <span class="flex items-center gap-1.5">
          <i icon name="globe" class="w-4 h-4 text-gold-500"></i>
          {{ origin() }}
        </span>
      }

      @if (isVerified()) {
        <span class="flex items-center gap-1.5 text-green-500">
          <i icon name="check-circle" class="w-4 h-4"></i>
          Vérifié
        </span>
      }
    </div>

    <!-- Section 3: Description -->
    @if (description()) {
      <p class="mt-4 text-smoke-200 text-sm leading-relaxed">
        {{ description() }}
      </p>
    }

    <!-- Section 4: Community Rating -->
    @if (tastingCount() > 0) {
      <div class="mt-6 flex flex-col items-center gap-3 py-4">
        <ui-rating-bands
          [value]="averageRating()"
          [readonly]="true"
          [compact]="true"
          [hideValue]="true"
        />
        <p class="text-sm text-smoke-400">
          <span class="text-gold-500 font-semibold">{{ averageRating() }}/5</span>
          <span class="mx-1">·</span>
          Note communautaire basée sur {{ tastingCount() }} {{ tastingCount() === 1 ? 'dégustation' : 'dégustations' }}
        </p>
      </div>
    } @else {
      <div class="mt-6 flex flex-col items-center gap-2 py-4">
        <p class="text-sm text-smoke-500 italic">
          Aucune dégustation pour le moment
        </p>
        <p class="text-xs text-smoke-600">
          Soyez le premier à noter ce cigare
        </p>
      </div>
    }

    <!-- Divider -->
    <div class="mt-4 h-px bg-smoke-600"></div>

    <!-- Section 5: Tastings Grid -->
    <ui-tastings-grid
      [tastings]="tastings()"
      [loading]="tastingsLoading()"
      [showUsername]="true"
      emptyMessage="Aucune dégustation publique"
      emptySubMessage="Les dégustations de ce cigare apparaîtront ici"
      [showAddButton]="true"
      addButtonLabel="Déguster ce cigare"
      (addClick)="startTasting()"
    />
  }
</div>